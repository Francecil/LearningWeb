[TOC]

# 基本指令

## 指令xxx --help 

学习指令最佳方式

## 创建文件夹 mkdir

-m 指定该文件夹的权限 e.g. : `mkdir -m 770 a` 创建了770权限的 a 文件夹
没有设置权限的话，目录默认权限是 `rwx - umask`  
等价于`mkdir --mode=770 a`

-p  嵌套创建文件夹  e.g. : `mkdir -p a/b` 在当前文件夹下创建a文件夹，a文件夹下创建b文件夹。 且如果任意一层文件夹存在，不会报错。
等价于`mkdir --parents a/b`

-v 创建目录成功会有提示：mkdir: 已创建目录 "xxx"。  没什么用.

-Z 设置安全上下文，与SELinux有关，这边先不管

创建项目结构命令e.g.:
`mkdir -vp scf/{lib/,bin/,doc/{info,product},logs/{info,product},service/deploy/{info,product}}`

## 删除文件(夹)： rm [选项]... 文件...
  `-f, --force`        强制删除文件或目录(用于删除有内容的文件)
 ` -i `            每次删除都要确认[y + Enter]
  `-I `                   删除超过三个文件或者递归删除时会提醒一次，比起 -i更少打扰
     ` --no-preserve-root `  照删 '/' 目录
  `--preserve-root`   do not remove '/' (默认  防止误删)
  `-r, -R`  递归处理，将指定目录及目录下所有东西删除
 ` -d, --dir `       删除空目录
  `-v, --verbose `      打印处理过程

默认时，rm 不会删除目录。使用--recursive(-r 或-R)选项可删除每个给定
的目录，以及其下所有的内容。

## 创建文件： vim



### 一、进入/退出 vim的命令

用法:
  `vim [参数] [文件 ..]  `     编辑指定的文件
  或: `vim [参数] -  `             从标准输入(stdin)读取文本
  或: `vim [参数] -t tag   `       编辑 tag 定义处的文件
  或: `vim [参数] -q [errorfile] ` 编辑第一个出错处的文件

常用参数：
`+			`启动后跳到文件末尾
`   +<lnum>		`启动后跳到第 <lnum> 行
`+/pattern` 启动后将光标置于第一个与`pattern`匹配的串处
`-r`在上次正用vi编辑时发生系统崩溃，恢复filename


`ZZ  `                      退出vi并保存
`:q!   `                    退出vi，不保存
`:wq    `                   退出vi并保存

### 二、【记录中模式】常用移动光标类命令

输入的指令会暂存到寄存器，每输入一个字符会进行一次正则匹配(无效字符自动过滤)，成功则执行指令并清空寄存器

`h` ：光标左移一个字符【习惯用`←`or`backspace`】
`l` ：光标右移一个字符【习惯用`→`or `sapce`】

`k或Ctrl+p`：光标上移一行【习惯用`↑`】
`j或Ctrl+n` ：光标下移一行【习惯用`↓`or`Enter`】

`w或W` ：光标右移一个字至字首 (英文中字为单词
`b或B` ：光标左移一个字至字首
`e或E` ：光标右移一个字至字尾

`nG`：光标移至第n行首,注：没有第0行的概念
`n$`：光标移至第n行尾
`n+`：光标下移n行【习惯用`n↓`】
`n-`：光标上移n行【习惯用`n↑`】

`0 or home`：（注意是数字零）光标移至当前行首
`$ or end`：光标移至当前行尾

`H` ：光标移至屏幕(非文本)顶行
`M` ：光标移至屏幕中间行
`L` ：光标移至屏幕最后行

`gg`：移动到页首，文档的第一行
`G`：移动到页末，文档的最后一行

`)` ：光标移至下一句句首 匹配句子接受符号：. ? ! 等
`(` ：光标移至上一句句首
`}`：光标移至下一段落开头 匹配空行而不是`\n` ,就目前测试来说
`{`：光标移至上一段落开头

### 三、重复操作

`.` :重复上一次操作 测试发现某些指令不能重复

　　
### 四、自动补齐 未测试通过..

`C-n`      匹配下一个关键字
`C-p`      匹配上一个关键字

### 五、行合并

`J`        把下面一行合并到本行后面


### 六、屏幕翻滚类命令

`Ctrl+u`：向文件首翻半屏
`Ctrl+d`：向文件尾翻半屏
`Ctrl+f`：向文件尾翻一屏
`Ctrl＋b`：向文件首翻一屏

`nz`：将第n行滚至屏幕顶部，不指定n时将当前行滚至屏幕顶部。未测试通过..

### 七、插入文本类命令

`i`：在光标前进入插入模式
`a`：在光标后进入插入模式【最常用】
`I`：在当前行首进入插入模式
`A`：在当前行尾进入插入模式

`o `：   在光标下方新开一行并将光标置于新行行首，进入插入模式。
`O `：    同上，在光标上方。

`r`：替换当前字符,先按r再按其他字符可以替换当前字符,不进入替换模式
`R`：进入替换模式
`~`：更改当前光标下字符的大小写

`s`：删除当前光标字符，并进入插入模式
`S`：删除当前行，并进入插入模式

`ncw或nCW`：删除指定数目的字，并进入插入模式
`nCC`：删除指定数目的行，并进入插入模式

### 八、删除命令

`ndw或ndW`：删除光标处开始及其后的n-1个字[单词]，`dw`删除当前单词剩余部分

`d0`：(是数字0)删至行首
`d$`：删至行尾

`ndd`：删除当前行及其后n-1行,`dd`即只删当前行
`x或X`：删除一个字符，x删除光标后的，而X删除光标前的 (这边的光标指的是当前字符左部)

`c `       功能和d相同，区别在于完成删除操作后进入INSERT MODE
`cc`       也是删除当前行，然后进入INSERT MODE


### 九、搜索及替换命令

`/pattern`：从光标开始处向文件尾搜索pattern
`?pattern`：从光标开始处向文件首搜索pattern
`% `               查找配对的括号。测试未通过
`n`：在同一方向重复上一次搜索命令
`N`：在反方向上重复上一次搜索命令
`:s/p1/p2/g`：将当前行中所有p1均用p2替代
`:n1,n2s/p1/p2/g`：将第n1至n2行中所有p1均用p2替代
`:g/p1/s//p2/g`：将文件中所有p1均用p2替换
`.*[]^%~$` 在Vi中具有特殊含义，若需要查找则应该加上转义字符"\"
	
#### 查找的一些选项

>设置高亮

`:set hlsearch`    设置高亮

`:set nohlsearch ` 关闭高亮

`:nohlsearch`      关闭当前已经设置的高亮

>增量查找

`:set incsearch`   设置增量查找

`:set noincsearch` 关闭增量查找

### 十、恢复误操作

操作指的是2次esc之间进行的指令操作算是一次操作

`u`        撤销最后执行的命令
`U`        修正之前对该行的操作
`Ctrl+R`   Redo

### 十一、块操作

vim支持多达26个剪贴板

选块   先用v，C-v，V选择一块，然后用y复制，再用p粘贴。

`yy`     复制当前整行
`nyy`    复制当前行开始的n行内容

以下测试未通过..

`?nyy`   将光标当前行及其下n行的内容保存到寄存器?中，其中?为一个字母，n为一个数字
`?nyw`   将光标当前行及其下n个词保存到寄存器?中，其中?为一个字母，n为一个数字
`?nyl`   将光标当前行及其下n个字符保存到寄存器?中，其中?为一个字母，n为一个数字
`?p`     将寄存器?中的内容粘贴到光标位置之后。如果?是用yy复制的完整行，
         则粘贴在光标所在行下面。这里?可以是一个字母，也可以是一个数字 
`?P`     将寄存器a中的内容粘贴到光标位置之前。如果?是用yy复制的完整行，
         则粘贴在光标所在行上面。这里?可以是一个字母，也可以是一个数字 
`ay[motion]`
`ay$`    复制光标位置到行末并保存在寄存器a中
`ayft`   复制光标位置到当前行第一个字母t并保存在寄存器a中

以上指令皆可去掉a工作，则y,p对未命名寄存器工作（所有d,c,x,y的对象都被保存在这里）。

> 剪切/复制/粘贴

所有删除的内容自动被保存，可以用p键粘贴

### 十二、vim选项设置(未研究)

	all         列出所有选项设置情况
	term        设置终端类型
	ignorance   在搜索中忽略大小写
	list        显示制表位(Ctrl+I)和行尾标志($)
	number      显示行号
	report      显示由面向行的命令修改过的数目
	terse       显示简短的警告信息
	warn        在转到别的文件时若没保存当前文件则显示NO write信息
	nomagic     允许在搜索模式中，使用前面不带“\”的特殊字符
	nowrapscan  禁止vi在搜索到达文件两端时，又从另一端开始
	mesg        允许vi显示其他用户用write写到自己终端上的信息 

### 十三、Tips

`gg=G`： 代码格式化


# 文件I/O

`fcntl.h` : flag参数+open creat函数
`unistd.h` :  close lseek 函数

> int open(filename,flag,mode_t mode)

直接用八进制表示mode_t 0777 三位前面加个0 或者用 sys/types.h 中的类型表示

> int creat(filename,mode) 

函数只能以只写打开，所以现在一般被open新版本替代了 

`O_RDWR|O_CREAT|O_TRUNC`

> int close(int filedes)
现在一般利用进程终止会关闭文件的特点 而不显式关闭文件

> off_t lseek(filedes,off_t offset,int whence)


若filedes不能设置偏移量(fifo,socket,管道等filedes[文件描述符])
or 设置后的偏移量<0,返回-1；
否则 返回新的文件偏移量。

offset表示坐标处字节数，+为后，-为前

`whence`: `SEEK_SET: 文件开始处0  ; SEEK_CUR:当前值1 ; SEEK_END: 文件长度处2`
显式的为已打开文件设置偏移量

**注：**将当前偏移量记录在内核，用于下一次读or写操作

`e.q.: FILE_LEN=10; 此时设置lseek(filedes,20,0) 将返回20 `
对该文件下一次写将加长该文件，并在文件形成一个空洞；位于文件但未写过的字节都被读做0

关于空洞：后面会提到.

> ssize_t read(int filedes,void *buf,size_t nbytes)


> POSIX.1 read函数 int read(int filedes,char *buf,unsigned nbytes)


read success,return 读到的字节数。若到文件结尾，则返回0.


> int write(int filedes,char *buf,size_t nbytes) 返回值与nbytes一致，否则表示出错


## 文件共享

## ioctl

其他IO杂项的操作

## /dev/fd

`/dev/fd/0` 对应`dev/stdin` 1 2 对应stdout stderr

## fcntl(int fd,int cmd,...)

改变已打开文件的性质，具体看工具书




# 文件和目录

## 权限

对目录具有执行权限，指的是能进入该目录。

对目录具有读权限，指的是能用ls这样的命令去显示文件/目录列表

对目录具有写权限，指的是能在该目录下创建新文件/目录  （需要有执行权限

在没有执行权限的情况下读目录

	[gahing@gahing test]$ ll parent
	ls: 无法访问parent/child: 权限不够
	总用量 0
	?????????? ? ? ? ?            ? child

其中目录结构为 test/parent/child

删除文件 需要对当前目录有写和执行权限。对该文件无需任何权限

权限是从 su -> 有效用户 -> 有效组用户 -> 其他用户 的顺序去判断的.

如果进程拥有此文件，则按用户访问权限去判断，不查看组访问权限（即使组可以 用户不行。

## 新文件/目录 的所有权

新文件的用户ID为当前进程的有效用户ID 组ID 可以是进程组ID or 所在目录的组ID


